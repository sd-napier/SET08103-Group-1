name: Coursework_Workflow
on: push

jobs:
  Build:
    name: Build and Start Using docker-compose
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'adopt'
            # Build JAR without running tests yet
            - name: Build JAR
              run: mvn clean package -DskipTests

            # Start Docker services in the background
            - name: Start Docker Compose
              run: docker compose up -d

            # Wait for the database to be ready
            - name: Wait for DB
              run: |
                echo "Waiting 15s for DB to be ready..."
                sleep 15

            # Run integration tests
            - name: Run Tests
              run: mvn test

            # Optional: view surefire test results
            - name: Show Test Results
              run: cat target/surefire-reports/*.txt || true

            # Optional: shut down Docker containers after tests
            - name: Stop Docker Compose
              run: docker compose down
      #- name: view logs
       # run: docker logs set08103-group-1
